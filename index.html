<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Move to Islam</title>
    
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Move%20to%20Islam%22,%22short_name%22:%22MTI%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#020811%22,%22theme_color%22:%22#4ade80%22}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --primary: #4ade80; --accent: #D4AF37; --bg: #020811; --card: #0b1421; --border: rgba(255,255,255,0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { background: var(--bg); color: #fff; font-family: 'Poppins', sans-serif; height: 100vh; overflow: hidden; }

        /* UI Headers */
        .header { padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; background: rgba(2,8,17,0.95); position: fixed; top: 0; width: 100%; z-index: 1000; border-bottom: 1px solid var(--border); }
        .logo { font-weight: 700; font-size: 20px; letter-spacing: 1px; color: var(--primary); }
        
        /* Containers */
        .content { position: absolute; top: 65px; bottom: 85px; width: 100%; overflow-y: auto; padding: 15px; scroll-behavior: smooth; }
        .page { display: none; }
        .page.active { display: block; }

        /* Ramadan & Prayer Card */
        .time-card { background: linear-gradient(135deg, #0b1421, #1a2a44); padding: 20px; border-radius: 25px; border: 1px solid var(--border); margin-bottom: 15px; text-align: center; }
        .ramadan-flex { display: flex; justify-content: space-around; margin-top: 15px; border-top: 1px solid var(--border); padding-top: 15px; }
        .ramadan-item b { color: var(--primary); display: block; font-size: 18px; }

        /* Grid Cards */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid var(--border); cursor: pointer; }
        .card i { font-size: 26px; color: var(--accent); margin-bottom: 10px; }

        /* Quran Audio UI */
        .audio-bar { background: var(--primary); color: #000; padding: 15px; border-radius: 15px; display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .play-btn { background: #000; color: #fff; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        /* Navbar */
        .nav { position: fixed; bottom: 15px; left: 15px; right: 15px; height: 70px; background: rgba(11, 20, 33, 0.95); border-radius: 20px; border: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1001; backdrop-filter: blur(10px); }
        .nav-item { color: rgba(255,255,255,0.4); text-align: center; font-size: 11px; flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 3px; }

        /* Install Button */
        .btn-install { background: var(--primary); color: #000; padding: 15px; border-radius: 15px; font-weight: 700; width: 100%; border: none; margin-top: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <i class="fa-solid fa-mosque" style="color:var(--primary)"></i>
        <div class="logo">MOVE TO ISLAM</div>
        <i class="fa-solid fa-circle-user" onclick="nav('profile')" style="font-size:22px"></i>
    </div>

    <div class="content">
        <div id="home" class="page active">
            <div class="time-card">
                <h1 id="clock" style="font-size: 45px;">00:00</h1>
                <p id="hijri" style="color:var(--accent); font-size: 14px;"></p>
                <div class="ramadan-flex">
                    <div class="ramadan-item">সেহরি (ঢাকা)<b id="sehri">--:--</b></div>
                    <div class="ramadan-item">ইফতার (ঢাকা)<b id="iftar">--:--</b></div>
                </div>
            </div>
            
            <div id="prayer-times" class="grid"></div>

            <div class="grid">
                <div class="card" onclick="nav('quran'); loadQuran();"><i class="fa-solid fa-book-quran"></i><br>কুরআন</div>
                <div class="card" onclick="nav('tasbih')"><i class="fa-solid fa-fingerprint"></i><br>তসবিহ</div>
                <div class="card" onclick="nav('ai')"><i class="fa-solid fa-comment-nodes"></i><br>Islamic AI</div>
                <div class="card" onclick="nav('kalima')"><i class="fa-solid fa-kaaba"></i><br>কালিমা</div>
            </div>
        </div>

        <div id="quran" class="page">
            <div id="audio-player-ui" style="display:none">
                <div class="audio-bar">
                    <div class="play-btn" onclick="toggleAudio()"><i id="play-icon" class="fa-solid fa-play"></i></div>
                    <div style="flex:1"><b id="surah-title">Select Surah</b><br><small>Reciter: Rashid Alafasy</small></div>
                    <audio id="main-audio"></audio>
                    <i class="fa-solid fa-xmark" onclick="closeQuran()" style="cursor:pointer"></i>
                </div>
            </div>
            <div id="surah-list"></div>
        </div>

        <div id="ai" class="page">
            <div id="ai-messages" style="height: 50vh; overflow-y: auto; background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 15px;"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="ai-input" placeholder="ইসলামিক প্রশ্ন করুন..." style="flex:1; padding:15px; border-radius:15px; background:var(--card); border:1px solid var(--border); color:#fff;">
                <button onclick="askAI()" style="background:var(--primary); border:none; width:55px; border-radius:15px;"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>

        <div id="profile" class="page">
            <div class="card">
                <img id="p-img" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" style="width:80px; height:80px; border-radius:50%; border:2px solid var(--primary);">
                <h2 style="margin-top:10px;">Move to Islam User</h2>
                <button class="btn-install" onclick="installAPK()">
                    <i class="fa-solid fa-download"></i> INSTALL AS APK
                </button>
            </div>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="nav('home', this)"><i class="fa-solid fa-house"></i>হোম</div>
        <div class="nav-item" onclick="nav('quran', this); loadQuran();"><i class="fa-solid fa-book-open"></i>কুরআন</div>
        <div class="nav-item" onclick="nav('ai', this)"><i class="fa-solid fa-robot"></i>এআই চ্যাট</div>
        <div class="nav-item" onclick="nav('profile', this)"><i class="fa-solid fa-user-gear"></i>প্রোফাইল</div>
    </div>

    <script>
        let deferredPrompt;

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');
            }
        }

        // --- Bangladesh Prayer & Ramadan Times ---
        async function fetchTimes() {
            const res = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Dhaka&country=Bangladesh&method=1');
            const data = await res.json();
            const t = data.data.timings;
            
            document.getElementById('sehri').innerText = t.Imsak;
            document.getElementById('iftar').innerText = t.Maghrib;
            document.getElementById('hijri').innerText = data.data.date.hijri.day + " " + data.data.date.hijri.month.en + " " + data.data.date.hijri.year;
            
            const pNames = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            document.getElementById('prayer-times').innerHTML = pNames.map(p => `
                <div class="card" style="padding:15px;">
                    <small>${p}</small><br><b style="color:var(--primary); font-size:18px;">${t[p]}</b>
                </div>
            `).join('');
        }

        // --- Quran Audio Logic ---
        async function loadQuran() {
            const list = document.getElementById('surah-list');
            if(list.innerHTML !== "") return;
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            list.innerHTML = data.data.map(s => `
                <div class="card" style="display:flex; justify-content:space-between; margin-bottom:10px; text-align:left;" onclick="playSurah(${s.number}, '${s.englishName}')">
                    <div><b>${s.number}. ${s.englishName}</b></div>
                    <div style="color:var(--primary)">${s.name}</div>
                </div>
            `).join('');
        }

        function playSurah(id, name) {
            const player = document.getElementById('main-audio');
            const ui = document.getElementById('audio-player-ui');
            const title = document.getElementById('surah-title');
            
            ui.style.display = 'block';
            title.innerText = "Sura " + name;
            player.src = `https://download.quranicaudio.com/qdc/mishari_rashid_al_afasy/murattal/${id}.mp3`;
            player.play();
            document.getElementById('play-icon').className = 'fa-solid fa-pause';
        }

        function toggleAudio() {
            const player = document.getElementById('main-audio');
            const icon = document.getElementById('play-icon');
            if(player.paused) { player.play(); icon.className = 'fa-solid fa-pause'; }
            else { player.pause(); icon.className = 'fa-solid fa-play'; }
        }

        function closeQuran() {
            document.getElementById('main-audio').pause();
            document.getElementById('audio-player-ui').style.display = 'none';
        }

        // --- AI Section ---
        async function askAI() {
            const input = document.getElementById('ai-input');
            const box = document.getElementById('ai-messages');
            if(!input.value) return;
            
            box.innerHTML += `<p style="text-align:right; color:var(--primary); margin-bottom:10px;"><b>You:</b> ${input.value}</p>`;
            const prompt = input.value;
            input.value = "";
            
            const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}?system=You are a wise Islamic Assistant. Answer in Bengali or English based on user.`);
            const text = await res.text();
            box.innerHTML += `<p style="margin-bottom:15px; border-left:2px solid var(--accent); padding-left:10px;"><b>AI:</b> ${text}</p>`;
            box.scrollTop = box.scrollHeight;
        }

        // --- APK Installer Logic ---
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        function installAPK() {
            if(deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choice) => {
                    if(choice.outcome === 'accepted') Swal.fire('Installing...', '', 'success');
                });
            } else {
                Swal.fire('Info', 'Chrome মেনু থেকে "Add to Home Screen" এ ক্লিক করুন।', 'info');
            }
        }

        // Init
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', {hour:'2-digit', minute:'2-digit'}); }, 1000);
        fetchTimes();
    </script>
</body>
</html>
